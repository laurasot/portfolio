---
import styles from './Education.module.css';

interface Tag {
    name: string;
    highlighted?: boolean;
}

interface EducationItem {
    id: number;
    title: string;
    institution: string;
    year: string;
    type: 'Educación' | 'Certificación';
    description?: string;
    tags?: Tag[];
    badgeUrl?: string;
}

const educationItems: EducationItem[] = [
    {
        id: 1,
        title: 'Técnico en programación y análisis de sistemas',
        institution: 'Instituto Profesional San Sebastian',
        year: '2025 - 2028',
        type: 'Educación',
        description: 'Especialización en Cloud Computing e Infraestructura',
        tags: [
            { name: 'AWS', highlighted: true },
            { name: 'Cloud' },
            { name: 'Architecture' },
            { name: 'Solutions Design' },
            { name: 'Database Design' },
        ],
    },
    {
        id: 2,
        title: 'Certified Tech Developer',
        institution: 'Digital House',
        year: '2023 - 2025',
        type: 'Educación',
        description: 'Especialización full stack developer',
        tags: [
            { name: 'React', highlighted: true },
            { name: 'Java', highlighted: true  },
            { name: 'JavaScript' },
            { name: 'Solutions Design'},
            { name: 'Testing' },
            { name: 'Cloud Computing'}
        ],
    },
];

const certificationItems: EducationItem[] = [
    {
        id: 3,
        title: 'Bootcamp Fundamentos de la Inteligencia Artificial',
        institution: 'IBM and Guayerd',
        year: '2025',
        type: 'Certificación',
        tags: [
            { name: 'Data Visualization' },
            { name: 'Machine Learning' },
            { name: 'Data Analysis', highlighted: true }
        ],
        badgeUrl: 'https://www.credly.com/badges/4fd1c099-dc40-4e7f-b7c0-3bd62d1584e6',
    },
    {
        id: 4,
        title: 'AWS Certified Cloud Practitioner',
        institution: 'Amazon Web Services',
        year: '2025',
        type: 'Certificación',
        tags: [
            { name: 'AWS', highlighted: true },
            { name: 'Cloud' },
            { name: 'Arquitectura' }
        ],
        badgeUrl: 'https://www.credly.com/badges/2a9b1667-96de-48a1-a81c-39b71ea88d99/linked_in_profile',
    },
    {
        id: 5,
        title: 'AWS Certified AI Practitioner',
        institution: 'Amazon Web Services',
        year: '2025',
        type: 'Certificación',
        tags: [
            { name: 'AWS', highlighted: true },
            { name: 'AI Fundamentals' },
            { name: 'Neural Networks' },
            { name: 'Machine Learning' },
            { name: 'Generative AI', highlighted: true },
        ],
        badgeUrl: 'https://www.credly.com/badges/20919825-bb26-4752-b657-fa22b674730e/linked_in_profile',
    },
    {
        id: 6,
        title: 'Bootcamp Java Full Stack',
        institution: 'Coding Dojo',
        year: '2022',
        type: 'Certificación',
        tags: [
            { name: 'Java' },
            { name: 'POO' },
            { name: 'Spring Boot', highlighted: true }
        ]
    },
    {
        id: 7,
        title: 'Bootcamp Ruby on Rails',
        institution: 'Le wagon',
        year: '2021',
        type: 'Certificación',
        tags: [
            { name: 'Ruby', highlighted: true },
            { name: 'Rails' },
            { name: 'Git' }
        ],
    },
];
---

<section class={styles.educationContainer} id="educacion">
    <div class={styles.grainTexture} />
    <div class={styles.educationContent}>
        <div class={styles.sectionHeader}>
            <h2 class={styles.sectionTitle}>Formación</h2>
        </div>

        <div class={styles.educationSection}>
            <h3 class={styles.subsectionTitle}>Educación Formal</h3>
            <div class={styles.educationGrid}>
                {educationItems.map((item) => (
                    <article
                        class={styles.educationCard}
                        data-type={item.type}
                        data-id={item.id}
                        data-accordion="education-card"
                    >
                        {/* Botón de acordeón (solo visible en móvil) */}
                        <button
                            type="button"
                            class={styles.cardToggle}
                            data-role="card-toggle"
                            aria-expanded="false"
                            aria-controls={`education-content-${item.id}`}
                        >
                            <h4 class={styles.educationTitle}>{item.title}</h4>
                            <span class={styles.toggleIcon}>+</span>
                        </button>

                        {/* Contenido real de la tarjeta */}
                        <div
                            class={styles.cardBody}
                            data-role="card-body"
                            id={`education-content-${item.id}`}
                        >
                            <div class={styles.cardHeader}>
                                <span class={styles.educationYear}>{item.year}</span>
                            </div>

                            {/* Título para desktop (se oculta en móvil) */}
                            <h4 class={styles.educationTitle}>{item.title}</h4>
                            <p class={styles.educationInstitution}>{item.institution}</p>

                            {item.description && (
                                <p class={styles.educationDescription}>
                                    {item.description}
                                </p>
                            )}

                            {item.tags && item.tags.length > 0 && (
                                <div class={styles.educationTags}>
                                    {item.tags.map((tag) => (
                                        <span 
                                            class={`${styles.educationTag} ${tag.highlighted ? styles.highlighted : ''}`}
                                        >
                                            {tag.name}
                                        </span>
                                    ))}
                                </div>
                            )}
                        </div>
                    </article>
                ))}
            </div>
        </div>

        <div class={styles.certificationSection}>
            <h3 class={styles.subsectionTitle}>Certificaciones</h3>
            <div class={styles.certificationGrid}>
                {certificationItems.map((item) => (
                    <article
                        class={styles.educationCard}
                        data-type={item.type}
                        data-id={item.id}
                        data-accordion="education-card"
                    >
                        {/* Botón de acordeón (solo móvil) */}
                        <button
                            type="button"
                            class={styles.cardToggle}
                            data-role="card-toggle"
                            aria-expanded="false"
                            aria-controls={`certification-content-${item.id}`}
                        >
                            <h4 class={styles.educationTitle}>{item.title}</h4>
                            <span class={styles.toggleIcon}>+</span>
                        </button>

                        {/* Contenido real */}
                        <div
                            class={styles.cardBody}
                            data-role="card-body"
                            id={`certification-content-${item.id}`}
                        >
                            <div class={styles.cardHeader}>
                                <span class={styles.educationYear}>{item.year}</span>
                            </div>

                            {/* Título para desktop */}
                            <h4 class={styles.educationTitle}>{item.title}</h4>
                            <p class={styles.educationInstitution}>{item.institution}</p>

                            {item.description && (
                                <p class={styles.educationDescription}>
                                    {item.description}
                                </p>
                            )}

                            {item.tags && item.tags.length > 0 && (
                                <div class={styles.educationTags}>
                                    {item.tags.map((tag) => (
                                        <span 
                                            class={`${styles.educationTag} ${tag.highlighted ? styles.highlighted : ''}`}
                                        >
                                            {tag.name}
                                        </span>
                                    ))}
                                </div>
                            )}

                            {item.badgeUrl && item.badgeUrl.trim() !== '' && (
                                <a
                                    href={item.badgeUrl}
                                    class={styles.badgeButton}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                >
                                    VER BADGE
                                </a>
                            )}
                        </div>
                    </article>
                ))}
            </div>
        </div>
    </div>

    <script>
        if (typeof document !== 'undefined') {
            const initEducationAccordion = () => {
                const isMobile = window.matchMedia('(max-width: 768px)').matches;
                const cards = document.querySelectorAll('[data-accordion="education-card"]');

                cards.forEach((card) => {
                    const toggle = card.querySelector('[data-role="card-toggle"]') as HTMLButtonElement | null;
                    const body = card.querySelector('[data-role="card-body"]') as HTMLElement | null;
                    if (!toggle || !body) return;

                    // Desktop → acordeón desactivado
                    if (!isMobile) {
                        card.removeAttribute('data-open');
                        toggle.setAttribute('aria-expanded', 'true');
                        return;
                    }

                    // Móvil → colapsado por defecto si aún no se inicializó
                    if (!card.hasAttribute('data-init')) {
                        card.setAttribute('data-init', 'true');
                        toggle.setAttribute('aria-expanded', 'false');
                        card.setAttribute('data-open', 'false');

                        toggle.addEventListener('click', () => {
                            const isOpen = card.getAttribute('data-open') === 'true';
                            card.setAttribute('data-open', isOpen ? 'false' : 'true');
                            toggle.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
                        });
                    }
                });
            };

            document.addEventListener('DOMContentLoaded', initEducationAccordion);
            window.addEventListener('resize', () => {
                // pequeño debounce
                window.clearTimeout((window as any).__eduResizeTimer);
                (window as any).__eduResizeTimer = window.setTimeout(initEducationAccordion, 200);
            });
        }
    </script>
</section>
